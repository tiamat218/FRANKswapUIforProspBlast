{"ast":null,"code":"import{useCallback,useEffect,useState}from'react';import{useDispatch}from'react-redux';import useActiveWeb3React from'hooks/useActiveWeb3React';import useDebounce from'hooks/useDebounce';import useIsWindowVisible from'hooks/useIsWindowVisible';import{updateBlockNumber}from'./actions';export default function Updater(){const{library,chainId}=useActiveWeb3React();const dispatch=useDispatch();const windowVisible=useIsWindowVisible();const[state,setState]=useState({chainId,blockNumber:null});const blockNumberCallback=useCallback(blockNumber=>{setState(prev=>{if(chainId===prev.chainId){if(typeof prev.blockNumber!=='number')return{chainId,blockNumber};return{chainId,blockNumber:Math.max(blockNumber,prev.blockNumber)};}return prev;});},[chainId,setState]);// attach/detach listeners\nuseEffect(()=>{if(!library||!chainId||!windowVisible)return undefined;setState({chainId,blockNumber:null});library.getBlockNumber().then(blockNumberCallback).catch(error=>console.error(\"Failed to get block number for chainId: \".concat(chainId),error));library.on('block',blockNumberCallback);return()=>{library.removeListener('block',blockNumberCallback);};},[dispatch,chainId,library,blockNumberCallback,windowVisible]);const debouncedState=useDebounce(state,100);useEffect(()=>{if(!debouncedState.chainId||!debouncedState.blockNumber||!windowVisible)return;dispatch(updateBlockNumber({chainId:debouncedState.chainId,blockNumber:debouncedState.blockNumber}));},[windowVisible,dispatch,debouncedState.blockNumber,debouncedState.chainId]);return null;}","map":{"version":3,"names":["useCallback","useEffect","useState","useDispatch","useActiveWeb3React","useDebounce","useIsWindowVisible","updateBlockNumber","Updater","library","chainId","dispatch","windowVisible","state","setState","blockNumber","blockNumberCallback","prev","Math","max","undefined","getBlockNumber","then","catch","error","console","concat","on","removeListener","debouncedState"],"sources":["C:/Users/frkul/Documents/swapUI_pancake-frontend/src/state/application/updater.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react'\r\nimport { useDispatch } from 'react-redux'\r\nimport useActiveWeb3React from 'hooks/useActiveWeb3React'\r\nimport useDebounce from 'hooks/useDebounce'\r\nimport useIsWindowVisible from 'hooks/useIsWindowVisible'\r\nimport { updateBlockNumber } from './actions'\r\n\r\nexport default function Updater(): null {\r\n  const { library, chainId } = useActiveWeb3React()\r\n  const dispatch = useDispatch()\r\n\r\n  const windowVisible = useIsWindowVisible()\r\n\r\n  const [state, setState] = useState<{ chainId: number | undefined; blockNumber: number | null }>({\r\n    chainId,\r\n    blockNumber: null,\r\n  })\r\n\r\n  const blockNumberCallback = useCallback(\r\n    (blockNumber: number) => {\r\n      setState((prev) => {\r\n        if (chainId === prev.chainId) {\r\n          if (typeof prev.blockNumber !== 'number') return { chainId, blockNumber }\r\n          return { chainId, blockNumber: Math.max(blockNumber, prev.blockNumber) }\r\n        }\r\n        return prev\r\n      })\r\n    },\r\n    [chainId, setState],\r\n  )\r\n\r\n  // attach/detach listeners\r\n  useEffect(() => {\r\n    if (!library || !chainId || !windowVisible) return undefined\r\n\r\n    setState({ chainId, blockNumber: null })\r\n\r\n    library\r\n      .getBlockNumber()\r\n      .then(blockNumberCallback)\r\n      .catch((error) => console.error(`Failed to get block number for chainId: ${chainId}`, error))\r\n\r\n    library.on('block', blockNumberCallback)\r\n    return () => {\r\n      library.removeListener('block', blockNumberCallback)\r\n    }\r\n  }, [dispatch, chainId, library, blockNumberCallback, windowVisible])\r\n\r\n  const debouncedState = useDebounce(state, 100)\r\n\r\n  useEffect(() => {\r\n    if (!debouncedState.chainId || !debouncedState.blockNumber || !windowVisible) return\r\n    dispatch(updateBlockNumber({ chainId: debouncedState.chainId, blockNumber: debouncedState.blockNumber }))\r\n  }, [windowVisible, dispatch, debouncedState.blockNumber, debouncedState.chainId])\r\n\r\n  return null\r\n}\r\n"],"mappings":"AAAA,OAASA,WAAW,CAAEC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CACxD,OAASC,WAAW,KAAQ,aAAa,CACzC,MAAO,CAAAC,kBAAkB,KAAM,0BAA0B,CACzD,MAAO,CAAAC,WAAW,KAAM,mBAAmB,CAC3C,MAAO,CAAAC,kBAAkB,KAAM,0BAA0B,CACzD,OAASC,iBAAiB,KAAQ,WAAW,CAE7C,cAAe,SAAS,CAAAC,OAAOA,CAAA,CAAS,CACtC,KAAM,CAAEC,OAAO,CAAEC,OAAQ,CAAC,CAAGN,kBAAkB,CAAC,CAAC,CACjD,KAAM,CAAAO,QAAQ,CAAGR,WAAW,CAAC,CAAC,CAE9B,KAAM,CAAAS,aAAa,CAAGN,kBAAkB,CAAC,CAAC,CAE1C,KAAM,CAACO,KAAK,CAAEC,QAAQ,CAAC,CAAGZ,QAAQ,CAA8D,CAC9FQ,OAAO,CACPK,WAAW,CAAE,IACf,CAAC,CAAC,CAEF,KAAM,CAAAC,mBAAmB,CAAGhB,WAAW,CACpCe,WAAmB,EAAK,CACvBD,QAAQ,CAAEG,IAAI,EAAK,CACjB,GAAIP,OAAO,GAAKO,IAAI,CAACP,OAAO,CAAE,CAC5B,GAAI,MAAO,CAAAO,IAAI,CAACF,WAAW,GAAK,QAAQ,CAAE,MAAO,CAAEL,OAAO,CAAEK,WAAY,CAAC,CACzE,MAAO,CAAEL,OAAO,CAAEK,WAAW,CAAEG,IAAI,CAACC,GAAG,CAACJ,WAAW,CAAEE,IAAI,CAACF,WAAW,CAAE,CAAC,CAC1E,CACA,MAAO,CAAAE,IAAI,CACb,CAAC,CAAC,CACJ,CAAC,CACD,CAACP,OAAO,CAAEI,QAAQ,CACpB,CAAC,CAED;AACAb,SAAS,CAAC,IAAM,CACd,GAAI,CAACQ,OAAO,EAAI,CAACC,OAAO,EAAI,CAACE,aAAa,CAAE,MAAO,CAAAQ,SAAS,CAE5DN,QAAQ,CAAC,CAAEJ,OAAO,CAAEK,WAAW,CAAE,IAAK,CAAC,CAAC,CAExCN,OAAO,CACJY,cAAc,CAAC,CAAC,CAChBC,IAAI,CAACN,mBAAmB,CAAC,CACzBO,KAAK,CAAEC,KAAK,EAAKC,OAAO,CAACD,KAAK,4CAAAE,MAAA,CAA4ChB,OAAO,EAAIc,KAAK,CAAC,CAAC,CAE/Ff,OAAO,CAACkB,EAAE,CAAC,OAAO,CAAEX,mBAAmB,CAAC,CACxC,MAAO,IAAM,CACXP,OAAO,CAACmB,cAAc,CAAC,OAAO,CAAEZ,mBAAmB,CAAC,CACtD,CAAC,CACH,CAAC,CAAE,CAACL,QAAQ,CAAED,OAAO,CAAED,OAAO,CAAEO,mBAAmB,CAAEJ,aAAa,CAAC,CAAC,CAEpE,KAAM,CAAAiB,cAAc,CAAGxB,WAAW,CAACQ,KAAK,CAAE,GAAG,CAAC,CAE9CZ,SAAS,CAAC,IAAM,CACd,GAAI,CAAC4B,cAAc,CAACnB,OAAO,EAAI,CAACmB,cAAc,CAACd,WAAW,EAAI,CAACH,aAAa,CAAE,OAC9ED,QAAQ,CAACJ,iBAAiB,CAAC,CAAEG,OAAO,CAAEmB,cAAc,CAACnB,OAAO,CAAEK,WAAW,CAAEc,cAAc,CAACd,WAAY,CAAC,CAAC,CAAC,CAC3G,CAAC,CAAE,CAACH,aAAa,CAAED,QAAQ,CAAEkB,cAAc,CAACd,WAAW,CAAEc,cAAc,CAACnB,OAAO,CAAC,CAAC,CAEjF,MAAO,KAAI,CACb","ignoreList":[]},"metadata":{},"sourceType":"module"}