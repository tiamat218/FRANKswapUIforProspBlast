{"ast":null,"code":"import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport { merge } from 'lodash';\nimport { ProposalState, VotingStateLoadingStatus } from 'state/types';\nimport { getAllVotes, getProposal, getProposals, getVoteVerificationStatuses } from './helpers';\nconst initialState = {\n  proposalLoadingStatus: VotingStateLoadingStatus.INITIAL,\n  proposals: {},\n  voteLoadingStatus: VotingStateLoadingStatus.INITIAL,\n  votes: {}\n};\n\n// Thunks\nexport const fetchProposals = createAsyncThunk('voting/fetchProposals', async ({\n  first,\n  skip = 0,\n  state = ProposalState.ACTIVE\n}) => {\n  const response = await getProposals(first, skip, state);\n  return response;\n});\nexport const fetchProposal = createAsyncThunk('voting/fetchProposal', async proposalId => {\n  const response = await getProposal(proposalId);\n  return response;\n});\nexport const fetchVotes = createAsyncThunk('voting/fetchVotes', async ({\n  proposalId,\n  block\n}) => {\n  const response = await getAllVotes(proposalId, block);\n  return {\n    votes: response,\n    proposalId\n  };\n});\nexport const verifyVotes = createAsyncThunk('voting/verifyVotes', async ({\n  proposalId,\n  snapshot\n}, {\n  getState\n}) => {\n  const state = getState();\n  const proposalVotes = state.voting.votes[proposalId];\n  const response = await getVoteVerificationStatuses(proposalVotes, Number(snapshot));\n  return {\n    results: response,\n    proposalId\n  };\n});\nexport const votingSlice = createSlice({\n  name: 'voting',\n  initialState,\n  reducers: {},\n  extraReducers: builder => {\n    // Verify Votes\n    builder.addCase(verifyVotes.fulfilled, (state, action) => {\n      const {\n        proposalId,\n        results\n      } = action.payload;\n      if (state.votes[proposalId]) {\n        state.votes[proposalId] = state.votes[proposalId].map(vote => {\n          return {\n            ...vote,\n            _inValid: results[vote.id] === false\n          };\n        });\n      }\n    });\n\n    // Fetch Proposals\n    builder.addCase(fetchProposals.pending, state => {\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING;\n    });\n    builder.addCase(fetchProposals.fulfilled, (state, action) => {\n      const proposals = action.payload.reduce((accum, proposal) => {\n        return {\n          ...accum,\n          [proposal.id]: proposal\n        };\n      }, {});\n      state.proposals = merge({}, state.proposals, proposals);\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE;\n    });\n\n    // Fetch Proposal\n    builder.addCase(fetchProposal.pending, state => {\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING;\n    });\n    builder.addCase(fetchProposal.fulfilled, (state, action) => {\n      state.proposals[action.payload.id] = action.payload;\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE;\n    });\n\n    // Fetch Votes\n    builder.addCase(fetchVotes.pending, state => {\n      state.voteLoadingStatus = VotingStateLoadingStatus.LOADING;\n    });\n    builder.addCase(fetchVotes.fulfilled, (state, action) => {\n      const {\n        votes,\n        proposalId\n      } = action.payload;\n      state.votes = {\n        ...state.votes,\n        [proposalId]: votes\n      };\n      state.voteLoadingStatus = VotingStateLoadingStatus.IDLE;\n    });\n  }\n});\nexport default votingSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","merge","ProposalState","VotingStateLoadingStatus","getAllVotes","getProposal","getProposals","getVoteVerificationStatuses","initialState","proposalLoadingStatus","INITIAL","proposals","voteLoadingStatus","votes","fetchProposals","first","skip","state","ACTIVE","response","fetchProposal","proposalId","fetchVotes","block","verifyVotes","snapshot","getState","proposalVotes","voting","Number","results","votingSlice","name","reducers","extraReducers","builder","addCase","fulfilled","action","payload","map","vote","_inValid","id","pending","LOADING","reduce","accum","proposal","IDLE","reducer"],"sources":["C:/Users/Devrim/Documents/FRANKswapUIforProspBlast/src/state/voting/index.tsx"],"sourcesContent":["import { createAsyncThunk, createSlice } from '@reduxjs/toolkit'\r\nimport { merge } from 'lodash'\r\nimport { Proposal, ProposalState, VotingStateLoadingStatus, VotingState, Vote, State } from 'state/types'\r\nimport { getAllVotes, getProposal, getProposals, getVoteVerificationStatuses } from './helpers'\r\n\r\nconst initialState: VotingState = {\r\n  proposalLoadingStatus: VotingStateLoadingStatus.INITIAL,\r\n  proposals: {},\r\n  voteLoadingStatus: VotingStateLoadingStatus.INITIAL,\r\n  votes: {},\r\n}\r\n\r\n// Thunks\r\nexport const fetchProposals = createAsyncThunk<Proposal[], { first?: number; skip?: number; state?: ProposalState }>(\r\n  'voting/fetchProposals',\r\n  async ({ first, skip = 0, state = ProposalState.ACTIVE }) => {\r\n    const response = await getProposals(first, skip, state)\r\n    return response\r\n  },\r\n)\r\n\r\nexport const fetchProposal = createAsyncThunk<Proposal, string>('voting/fetchProposal', async (proposalId) => {\r\n  const response = await getProposal(proposalId)\r\n  return response\r\n})\r\n\r\nexport const fetchVotes = createAsyncThunk<\r\n  { votes: Vote[]; proposalId: string },\r\n  { proposalId: string; block?: number }\r\n>('voting/fetchVotes', async ({ proposalId, block }) => {\r\n  const response = await getAllVotes(proposalId, block)\r\n  return { votes: response, proposalId }\r\n})\r\n\r\nexport const verifyVotes = createAsyncThunk<\r\n  { results: { [key: string]: boolean }; proposalId: string },\r\n  { proposalId: string; snapshot?: string },\r\n  { state: State }\r\n>('voting/verifyVotes', async ({ proposalId, snapshot }, { getState }) => {\r\n  const state = getState()\r\n  const proposalVotes = state.voting.votes[proposalId]\r\n  const response = await getVoteVerificationStatuses(proposalVotes, Number(snapshot))\r\n  return { results: response, proposalId }\r\n})\r\n\r\nexport const votingSlice = createSlice({\r\n  name: 'voting',\r\n  initialState,\r\n  reducers: {},\r\n  extraReducers: (builder) => {\r\n    // Verify Votes\r\n    builder.addCase(verifyVotes.fulfilled, (state, action) => {\r\n      const { proposalId, results } = action.payload\r\n\r\n      if (state.votes[proposalId]) {\r\n        state.votes[proposalId] = state.votes[proposalId].map((vote) => {\r\n          return {\r\n            ...vote,\r\n            _inValid: results[vote.id] === false,\r\n          }\r\n        })\r\n      }\r\n    })\r\n\r\n    // Fetch Proposals\r\n    builder.addCase(fetchProposals.pending, (state) => {\r\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING\r\n    })\r\n    builder.addCase(fetchProposals.fulfilled, (state, action) => {\r\n      const proposals = action.payload.reduce((accum, proposal) => {\r\n        return {\r\n          ...accum,\r\n          [proposal.id]: proposal,\r\n        }\r\n      }, {})\r\n\r\n      state.proposals = merge({}, state.proposals, proposals)\r\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE\r\n    })\r\n\r\n    // Fetch Proposal\r\n    builder.addCase(fetchProposal.pending, (state) => {\r\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING\r\n    })\r\n    builder.addCase(fetchProposal.fulfilled, (state, action) => {\r\n      state.proposals[action.payload.id] = action.payload\r\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE\r\n    })\r\n\r\n    // Fetch Votes\r\n    builder.addCase(fetchVotes.pending, (state) => {\r\n      state.voteLoadingStatus = VotingStateLoadingStatus.LOADING\r\n    })\r\n    builder.addCase(fetchVotes.fulfilled, (state, action) => {\r\n      const { votes, proposalId } = action.payload\r\n\r\n      state.votes = {\r\n        ...state.votes,\r\n        [proposalId]: votes,\r\n      }\r\n      state.voteLoadingStatus = VotingStateLoadingStatus.IDLE\r\n    })\r\n  },\r\n})\r\n\r\nexport default votingSlice.reducer\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}