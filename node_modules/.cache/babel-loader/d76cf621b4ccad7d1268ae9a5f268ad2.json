{"ast":null,"code":"import React,{useEffect,useMemo}from'react';import{useDispatch,useSelector}from'react-redux';import{Text,Flex,Link}from'@pancakeswap/uikit';import useActiveWeb3React from'hooks/useActiveWeb3React';import{getBscScanLink}from'utils';import useToast from'hooks/useToast';import{useBlockNumber}from'../application/hooks';import{checkedTransaction,finalizeTransaction}from'./actions';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export function shouldCheck(lastBlockNumber,tx){if(tx.receipt)return false;if(!tx.lastCheckedBlockNumber)return true;const blocksSinceCheck=lastBlockNumber-tx.lastCheckedBlockNumber;if(blocksSinceCheck<1)return false;const minutesPending=(new Date().getTime()-tx.addedTime)/1000/60;if(minutesPending>60){// every 10 blocks if pending for longer than an hour\nreturn blocksSinceCheck>9;}if(minutesPending>5){// every 3 blocks if pending more than 5 minutes\nreturn blocksSinceCheck>2;}// otherwise every block\nreturn true;}export default function Updater(){const{library,chainId}=useActiveWeb3React();const lastBlockNumber=useBlockNumber();const dispatch=useDispatch();const state=useSelector(s=>s.transactions);const transactions=useMemo(()=>{var _state$chainId;return chainId?(_state$chainId=state[chainId])!==null&&_state$chainId!==void 0?_state$chainId:{}:{};},[chainId,state]);const{toastError,toastSuccess}=useToast();useEffect(()=>{if(!chainId||!library||!lastBlockNumber)return;Object.keys(transactions).filter(hash=>shouldCheck(lastBlockNumber,transactions[hash])).forEach(hash=>{library.getTransactionReceipt(hash).then(receipt=>{if(receipt){var _transactions$hash$su,_transactions$hash;dispatch(finalizeTransaction({chainId,hash,receipt:{blockHash:receipt.blockHash,blockNumber:receipt.blockNumber,contractAddress:receipt.contractAddress,from:receipt.from,status:receipt.status,to:receipt.to,transactionHash:receipt.transactionHash,transactionIndex:receipt.transactionIndex}}));const toast=receipt.status===1?toastSuccess:toastError;toast('Transaction receipt',/*#__PURE__*/_jsxs(Flex,{flexDirection:\"column\",children:[/*#__PURE__*/_jsx(Text,{children:(_transactions$hash$su=(_transactions$hash=transactions[hash])===null||_transactions$hash===void 0?void 0:_transactions$hash.summary)!==null&&_transactions$hash$su!==void 0?_transactions$hash$su:\"Hash: \".concat(hash.slice(0,8),\"...\").concat(hash.slice(58,65))}),chainId&&/*#__PURE__*/_jsx(Link,{external:true,href:getBscScanLink(hash,'transaction',chainId),children:\"View on BscScan\"})]}));}else{dispatch(checkedTransaction({chainId,hash,blockNumber:lastBlockNumber}));}}).catch(error=>{console.error(\"failed to check transaction hash: \".concat(hash),error);});});},[chainId,library,transactions,lastBlockNumber,dispatch,toastSuccess,toastError]);return null;}","map":{"version":3,"names":["React","useEffect","useMemo","useDispatch","useSelector","Text","Flex","Link","useActiveWeb3React","getBscScanLink","useToast","useBlockNumber","checkedTransaction","finalizeTransaction","jsx","_jsx","jsxs","_jsxs","shouldCheck","lastBlockNumber","tx","receipt","lastCheckedBlockNumber","blocksSinceCheck","minutesPending","Date","getTime","addedTime","Updater","library","chainId","dispatch","state","s","transactions","_state$chainId","toastError","toastSuccess","Object","keys","filter","hash","forEach","getTransactionReceipt","then","_transactions$hash$su","_transactions$hash","blockHash","blockNumber","contractAddress","from","status","to","transactionHash","transactionIndex","toast","flexDirection","children","summary","concat","slice","external","href","catch","error","console"],"sources":["C:/Users/Devrim/Documents/FRANKswapUIforProspBlast/src/state/transactions/updater.tsx"],"sourcesContent":["import React, { useEffect, useMemo } from 'react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { Text, Flex, Link } from '@pancakeswap/uikit'\r\nimport useActiveWeb3React from 'hooks/useActiveWeb3React'\r\nimport { getBscScanLink } from 'utils'\r\nimport useToast from 'hooks/useToast'\r\nimport { useBlockNumber } from '../application/hooks'\r\nimport { AppDispatch, AppState } from '../index'\r\nimport { checkedTransaction, finalizeTransaction } from './actions'\r\n\r\nexport function shouldCheck(\r\n  lastBlockNumber: number,\r\n  tx: { addedTime: number; receipt?: any; lastCheckedBlockNumber?: number },\r\n): boolean {\r\n  if (tx.receipt) return false\r\n  if (!tx.lastCheckedBlockNumber) return true\r\n  const blocksSinceCheck = lastBlockNumber - tx.lastCheckedBlockNumber\r\n  if (blocksSinceCheck < 1) return false\r\n  const minutesPending = (new Date().getTime() - tx.addedTime) / 1000 / 60\r\n  if (minutesPending > 60) {\r\n    // every 10 blocks if pending for longer than an hour\r\n    return blocksSinceCheck > 9\r\n  }\r\n  if (minutesPending > 5) {\r\n    // every 3 blocks if pending more than 5 minutes\r\n    return blocksSinceCheck > 2\r\n  }\r\n  // otherwise every block\r\n  return true\r\n}\r\n\r\nexport default function Updater(): null {\r\n  const { library, chainId } = useActiveWeb3React()\r\n\r\n  const lastBlockNumber = useBlockNumber()\r\n\r\n  const dispatch = useDispatch<AppDispatch>()\r\n  const state = useSelector<AppState, AppState['transactions']>((s) => s.transactions)\r\n\r\n  const transactions = useMemo(() => (chainId ? state[chainId] ?? {} : {}), [chainId, state])\r\n\r\n  const { toastError, toastSuccess } = useToast()\r\n\r\n  useEffect(() => {\r\n    if (!chainId || !library || !lastBlockNumber) return\r\n\r\n    Object.keys(transactions)\r\n      .filter((hash) => shouldCheck(lastBlockNumber, transactions[hash]))\r\n      .forEach((hash) => {\r\n        library\r\n          .getTransactionReceipt(hash)\r\n          .then((receipt) => {\r\n            if (receipt) {\r\n              dispatch(\r\n                finalizeTransaction({\r\n                  chainId,\r\n                  hash,\r\n                  receipt: {\r\n                    blockHash: receipt.blockHash,\r\n                    blockNumber: receipt.blockNumber,\r\n                    contractAddress: receipt.contractAddress,\r\n                    from: receipt.from,\r\n                    status: receipt.status,\r\n                    to: receipt.to,\r\n                    transactionHash: receipt.transactionHash,\r\n                    transactionIndex: receipt.transactionIndex,\r\n                  },\r\n                }),\r\n              )\r\n\r\n              const toast = receipt.status === 1 ? toastSuccess : toastError\r\n              toast(\r\n                'Transaction receipt',\r\n                <Flex flexDirection=\"column\">\r\n                  <Text>{transactions[hash]?.summary ?? `Hash: ${hash.slice(0, 8)}...${hash.slice(58, 65)}`}</Text>\r\n                  {chainId && (\r\n                    <Link external href={getBscScanLink(hash, 'transaction', chainId)}>\r\n                      View on BscScan\r\n                    </Link>\r\n                  )}\r\n                </Flex>,\r\n              )\r\n            } else {\r\n              dispatch(checkedTransaction({ chainId, hash, blockNumber: lastBlockNumber }))\r\n            }\r\n          })\r\n          .catch((error) => {\r\n            console.error(`failed to check transaction hash: ${hash}`, error)\r\n          })\r\n      })\r\n  }, [chainId, library, transactions, lastBlockNumber, dispatch, toastSuccess, toastError])\r\n\r\n  return null\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}