{"ast":null,"code":"import React,{useState}from'react';import{Box,Modal}from'@pancakeswap/uikit';import{useWeb3React}from'@web3-react/core';import{useTranslation}from'contexts/Localization';import{SnapshotCommand}from'state/types';import{signMessage}from'utils/web3React';import useToast from'hooks/useToast';import useWeb3Provider from'hooks/useActiveWeb3React';import useTheme from'hooks/useTheme';import{ConfirmVoteView}from'./types';import MainView from'./MainView';import DetailsView from'./DetailsView';import{generatePayloadData,sendSnaphotData}from'../../helpers';import useGetVotingPower from'../../hooks/useGetVotingPower';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CastVoteModal=_ref=>{let{onSuccess,proposalId,vote,block,onDismiss}=_ref;const[view,setView]=useState(ConfirmVoteView.MAIN);const[modalIsOpen,setModalIsOpen]=useState(true);const[isPending,setIsPending]=useState(false);const{account}=useWeb3React();const{t}=useTranslation();const{toastError}=useToast();const{library}=useWeb3Provider();const{theme}=useTheme();const{isLoading,total,cakeBalance,cakeVaultBalance,cakePoolBalance,poolsBalance,cakeBnbLpBalance,verificationHash}=useGetVotingPower(block,modalIsOpen);const isStartView=view===ConfirmVoteView.MAIN;const handleBack=isStartView?null:()=>setView(ConfirmVoteView.MAIN);const handleViewDetails=()=>setView(ConfirmVoteView.DETAILS);const title={[ConfirmVoteView.MAIN]:t('Confirm Vote'),[ConfirmVoteView.DETAILS]:t('Voting Power')};const handleDismiss=()=>{setModalIsOpen(false);onDismiss();};const handleConfirmVote=async()=>{try{setIsPending(true);const voteMsg=JSON.stringify({...generatePayloadData(),type:SnapshotCommand.VOTE,payload:{proposal:proposalId,choice:vote.value,metadata:{votingPower:total.toString(),verificationHash}}});const sig=await signMessage(library,account,voteMsg);const msg={address:account,msg:voteMsg,sig};// Save proposal to snapshot\nawait sendSnaphotData(msg);setIsPending(false);await onSuccess();handleDismiss();}catch(error){setIsPending(false);toastError(t('Error'),error===null||error===void 0?void 0:error.message);console.error(error);}};return/*#__PURE__*/_jsx(Modal,{title:title[view],onBack:handleBack,onDismiss:onDismiss,hideCloseButton:!isStartView,headerBackground:theme.colors.gradients.cardHeader,children:/*#__PURE__*/_jsxs(Box,{mb:\"24px\",width:\"320px\",children:[view===ConfirmVoteView.MAIN&&/*#__PURE__*/_jsx(MainView,{vote:vote,isLoading:isLoading,isPending:isPending,total:total,onConfirm:handleConfirmVote,onViewDetails:handleViewDetails,onDismiss:handleDismiss}),view===ConfirmVoteView.DETAILS&&/*#__PURE__*/_jsx(DetailsView,{total:total,cakeBalance:cakeBalance,cakeVaultBalance:cakeVaultBalance,cakePoolBalance:cakePoolBalance,poolsBalance:poolsBalance,cakeBnbLpBalance:cakeBnbLpBalance})]})});};export default CastVoteModal;","map":{"version":3,"names":["React","useState","Box","Modal","useWeb3React","useTranslation","SnapshotCommand","signMessage","useToast","useWeb3Provider","useTheme","ConfirmVoteView","MainView","DetailsView","generatePayloadData","sendSnaphotData","useGetVotingPower","jsx","_jsx","jsxs","_jsxs","CastVoteModal","_ref","onSuccess","proposalId","vote","block","onDismiss","view","setView","MAIN","modalIsOpen","setModalIsOpen","isPending","setIsPending","account","t","toastError","library","theme","isLoading","total","cakeBalance","cakeVaultBalance","cakePoolBalance","poolsBalance","cakeBnbLpBalance","verificationHash","isStartView","handleBack","handleViewDetails","DETAILS","title","handleDismiss","handleConfirmVote","voteMsg","JSON","stringify","type","VOTE","payload","proposal","choice","value","metadata","votingPower","toString","sig","msg","address","error","message","console","onBack","hideCloseButton","headerBackground","colors","gradients","cardHeader","children","mb","width","onConfirm","onViewDetails"],"sources":["C:/Users/Devrim/Documents/FRANKswapUIforProspBlast/src/views/Voting/components/CastVoteModal/index.tsx"],"sourcesContent":["import React, { useState } from 'react'\r\nimport { Box, Modal } from '@pancakeswap/uikit'\r\nimport { useWeb3React } from '@web3-react/core'\r\nimport { useTranslation } from 'contexts/Localization'\r\nimport { SnapshotCommand } from 'state/types'\r\nimport { signMessage } from 'utils/web3React'\r\nimport useToast from 'hooks/useToast'\r\nimport useWeb3Provider from 'hooks/useActiveWeb3React'\r\nimport useTheme from 'hooks/useTheme'\r\nimport { CastVoteModalProps, ConfirmVoteView } from './types'\r\nimport MainView from './MainView'\r\nimport DetailsView from './DetailsView'\r\nimport { generatePayloadData, Message, sendSnaphotData } from '../../helpers'\r\nimport useGetVotingPower from '../../hooks/useGetVotingPower'\r\n\r\nconst CastVoteModal: React.FC<CastVoteModalProps> = ({ onSuccess, proposalId, vote, block, onDismiss }) => {\r\n  const [view, setView] = useState<ConfirmVoteView>(ConfirmVoteView.MAIN)\r\n  const [modalIsOpen, setModalIsOpen] = useState(true)\r\n  const [isPending, setIsPending] = useState(false)\r\n  const { account } = useWeb3React()\r\n  const { t } = useTranslation()\r\n  const { toastError } = useToast()\r\n  const { library } = useWeb3Provider()\r\n  const { theme } = useTheme()\r\n  const {\r\n    isLoading,\r\n    total,\r\n    cakeBalance,\r\n    cakeVaultBalance,\r\n    cakePoolBalance,\r\n    poolsBalance,\r\n    cakeBnbLpBalance,\r\n    verificationHash,\r\n  } = useGetVotingPower(block, modalIsOpen)\r\n\r\n  const isStartView = view === ConfirmVoteView.MAIN\r\n  const handleBack = isStartView ? null : () => setView(ConfirmVoteView.MAIN)\r\n  const handleViewDetails = () => setView(ConfirmVoteView.DETAILS)\r\n\r\n  const title = {\r\n    [ConfirmVoteView.MAIN]: t('Confirm Vote'),\r\n    [ConfirmVoteView.DETAILS]: t('Voting Power'),\r\n  }\r\n\r\n  const handleDismiss = () => {\r\n    setModalIsOpen(false)\r\n    onDismiss()\r\n  }\r\n\r\n  const handleConfirmVote = async () => {\r\n    try {\r\n      setIsPending(true)\r\n      const voteMsg = JSON.stringify({\r\n        ...generatePayloadData(),\r\n        type: SnapshotCommand.VOTE,\r\n        payload: {\r\n          proposal: proposalId,\r\n          choice: vote.value,\r\n          metadata: {\r\n            votingPower: total.toString(),\r\n            verificationHash,\r\n          },\r\n        },\r\n      })\r\n\r\n      const sig = await signMessage(library, account, voteMsg)\r\n      const msg: Message = { address: account, msg: voteMsg, sig }\r\n\r\n      // Save proposal to snapshot\r\n      await sendSnaphotData(msg)\r\n      setIsPending(false)\r\n\r\n      await onSuccess()\r\n\r\n      handleDismiss()\r\n    } catch (error) {\r\n      setIsPending(false)\r\n      toastError(t('Error'), error?.message)\r\n      console.error(error)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Modal\r\n      title={title[view]}\r\n      onBack={handleBack}\r\n      onDismiss={onDismiss}\r\n      hideCloseButton={!isStartView}\r\n      headerBackground={theme.colors.gradients.cardHeader}\r\n    >\r\n      <Box mb=\"24px\" width=\"320px\">\r\n        {view === ConfirmVoteView.MAIN && (\r\n          <MainView\r\n            vote={vote}\r\n            isLoading={isLoading}\r\n            isPending={isPending}\r\n            total={total}\r\n            onConfirm={handleConfirmVote}\r\n            onViewDetails={handleViewDetails}\r\n            onDismiss={handleDismiss}\r\n          />\r\n        )}\r\n        {view === ConfirmVoteView.DETAILS && (\r\n          <DetailsView\r\n            total={total}\r\n            cakeBalance={cakeBalance}\r\n            cakeVaultBalance={cakeVaultBalance}\r\n            cakePoolBalance={cakePoolBalance}\r\n            poolsBalance={poolsBalance}\r\n            cakeBnbLpBalance={cakeBnbLpBalance}\r\n          />\r\n        )}\r\n      </Box>\r\n    </Modal>\r\n  )\r\n}\r\n\r\nexport default CastVoteModal\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}