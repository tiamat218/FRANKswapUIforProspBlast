{"ast":null,"code":"/* eslint-disable no-continue */\n\n/* eslint-disable no-await-in-loop */\nimport schema from '@uniswap/token-lists/src/tokenlist.schema.json';\nimport Ajv from 'ajv';\nimport contenthashToUri from './contenthashToUri';\nimport { parseENSAddress } from './ENS/parseENSAddress';\nimport uriToHttp from './uriToHttp';\nconst tokenListValidator = new Ajv({\n  allErrors: true\n}).compile(schema);\nconst TARGET_CHAIN_ID = 81457;\n/**\r\n * Filters tokens based on the TARGET_CHAIN_ID\r\n * @param list TokenList\r\n */\n\nconst filterTokensByChainId = list => {\n  const filteredTokens = list.tokens.filter(token => token.chainId === TARGET_CHAIN_ID);\n  return { ...list,\n    tokens: filteredTokens\n  };\n};\n/**\r\n * Contains the logic for resolving a list URL to a validated token list\r\n * @param listUrl list url\r\n * @param resolveENSContentHash resolves an ens name to a contenthash\r\n */\n\n\nexport default async function getTokenList(listUrl, resolveENSContentHash) {\n  const parsedENS = parseENSAddress(listUrl);\n  let urls;\n\n  if (parsedENS) {\n    var _parsedENS$ensPath;\n\n    let contentHashUri;\n\n    try {\n      contentHashUri = await resolveENSContentHash(parsedENS.ensName);\n    } catch (error) {\n      console.error(`Failed to resolve ENS name: ${parsedENS.ensName}`, error);\n      throw new Error(`Failed to resolve ENS name: ${parsedENS.ensName}`);\n    }\n\n    let translatedUri;\n\n    try {\n      translatedUri = contenthashToUri(contentHashUri);\n    } catch (error) {\n      console.error('Failed to translate contenthash to URI', contentHashUri);\n      throw new Error(`Failed to translate contenthash to URI: ${contentHashUri}`);\n    }\n\n    urls = uriToHttp(`${translatedUri}${(_parsedENS$ensPath = parsedENS.ensPath) !== null && _parsedENS$ensPath !== void 0 ? _parsedENS$ensPath : ''}`);\n  } else {\n    urls = uriToHttp(listUrl);\n  }\n\n  for (let i = 0; i < urls.length; i++) {\n    const url = urls[i];\n    const isLast = i === urls.length - 1;\n    let response;\n\n    try {\n      response = await fetch(url);\n    } catch (error) {\n      console.error('Failed to fetch list', listUrl, error);\n      if (isLast) throw new Error(`Failed to download list ${listUrl}`);\n      continue;\n    }\n\n    if (!response.ok) {\n      if (isLast) throw new Error(`Failed to download list ${listUrl}`);\n      continue;\n    }\n\n    const json = await response.json();\n\n    if (!tokenListValidator(json)) {\n      var _tokenListValidator$e, _tokenListValidator$e2;\n\n      const validationErrors = (_tokenListValidator$e = (_tokenListValidator$e2 = tokenListValidator.errors) === null || _tokenListValidator$e2 === void 0 ? void 0 : _tokenListValidator$e2.reduce((memo, error) => {\n        var _error$message;\n\n        const add = `${error.dataPath} ${(_error$message = error.message) !== null && _error$message !== void 0 ? _error$message : ''}`;\n        return memo.length > 0 ? `${memo}; ${add}` : `${add}`;\n      }, '')) !== null && _tokenListValidator$e !== void 0 ? _tokenListValidator$e : 'unknown error';\n      throw new Error(`Token list failed validation: ${validationErrors}`);\n    }\n\n    const filteredList = filterTokensByChainId(json);\n    return filteredList;\n  }\n\n  throw new Error('Unrecognized list URL protocol.');\n}","map":{"version":3,"sources":["C:/Users/Devrim/Documents/FRANKswapUIforProspBlast/src/utils/getTokenList.ts"],"names":["schema","Ajv","contenthashToUri","parseENSAddress","uriToHttp","tokenListValidator","allErrors","compile","TARGET_CHAIN_ID","filterTokensByChainId","list","filteredTokens","tokens","filter","token","chainId","getTokenList","listUrl","resolveENSContentHash","parsedENS","urls","contentHashUri","ensName","error","console","Error","translatedUri","ensPath","i","length","url","isLast","response","fetch","ok","json","validationErrors","errors","reduce","memo","add","dataPath","message","filteredList"],"mappings":"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","sourcesContent":["/* eslint-disable no-continue */\r\n/* eslint-disable no-await-in-loop */\r\nimport { TokenList, TokenInfo } from '@uniswap/token-lists'\r\nimport schema from '@uniswap/token-lists/src/tokenlist.schema.json'\r\nimport Ajv from 'ajv'\r\nimport contenthashToUri from './contenthashToUri'\r\nimport { parseENSAddress } from './ENS/parseENSAddress'\r\nimport uriToHttp from './uriToHttp'\r\n\r\nconst tokenListValidator = new Ajv({ allErrors: true }).compile(schema)\r\n\r\nconst TARGET_CHAIN_ID = 81457\r\n\r\n/**\r\n * Filters tokens based on the TARGET_CHAIN_ID\r\n * @param list TokenList\r\n */\r\nconst filterTokensByChainId = (list: TokenList): TokenList => {\r\n  const filteredTokens = list.tokens.filter((token: TokenInfo) => token.chainId === TARGET_CHAIN_ID)\r\n  return { ...list, tokens: filteredTokens }\r\n}\r\n\r\n/**\r\n * Contains the logic for resolving a list URL to a validated token list\r\n * @param listUrl list url\r\n * @param resolveENSContentHash resolves an ens name to a contenthash\r\n */\r\nexport default async function getTokenList(\r\n  listUrl: string,\r\n  resolveENSContentHash: (ensName: string) => Promise<string>,\r\n): Promise<TokenList> {\r\n  const parsedENS = parseENSAddress(listUrl)\r\n  let urls: string[]\r\n  if (parsedENS) {\r\n    let contentHashUri\r\n    try {\r\n      contentHashUri = await resolveENSContentHash(parsedENS.ensName)\r\n    } catch (error) {\r\n      console.error(`Failed to resolve ENS name: ${parsedENS.ensName}`, error)\r\n      throw new Error(`Failed to resolve ENS name: ${parsedENS.ensName}`)\r\n    }\r\n    let translatedUri\r\n    try {\r\n      translatedUri = contenthashToUri(contentHashUri)\r\n    } catch (error) {\r\n      console.error('Failed to translate contenthash to URI', contentHashUri)\r\n      throw new Error(`Failed to translate contenthash to URI: ${contentHashUri}`)\r\n    }\r\n    urls = uriToHttp(`${translatedUri}${parsedENS.ensPath ?? ''}`)\r\n  } else {\r\n    urls = uriToHttp(listUrl)\r\n  }\r\n  for (let i = 0; i < urls.length; i++) {\r\n    const url = urls[i]\r\n    const isLast = i === urls.length - 1\r\n    let response\r\n    try {\r\n      response = await fetch(url)\r\n    } catch (error) {\r\n      console.error('Failed to fetch list', listUrl, error)\r\n      if (isLast) throw new Error(`Failed to download list ${listUrl}`)\r\n      continue\r\n    }\r\n\r\n    if (!response.ok) {\r\n      if (isLast) throw new Error(`Failed to download list ${listUrl}`)\r\n      continue\r\n    }\r\n\r\n    const json = await response.json()\r\n    if (!tokenListValidator(json)) {\r\n      const validationErrors: string =\r\n        tokenListValidator.errors?.reduce<string>((memo, error) => {\r\n          const add = `${(error as any).dataPath} ${error.message ?? ''}`\r\n          return memo.length > 0 ? `${memo}; ${add}` : `${add}`\r\n        }, '') ?? 'unknown error'\r\n      throw new Error(`Token list failed validation: ${validationErrors}`)\r\n    }\r\n    const filteredList = filterTokensByChainId(json as TokenList)\r\n    return filteredList\r\n  }\r\n  throw new Error('Unrecognized list URL protocol.')\r\n}\r\n"]},"metadata":{},"sourceType":"module"}