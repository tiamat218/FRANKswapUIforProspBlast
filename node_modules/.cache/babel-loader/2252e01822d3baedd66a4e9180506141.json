{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decrypt = exports.encrypt = exports.verifyHmac = exports.generateKey = void 0;\nconst tslib_1 = require(\"tslib\");\nconst isoCrypto = tslib_1.__importStar(require(\"@pedrouid/iso-crypto\"));\nconst encUtils = tslib_1.__importStar(require(\"enc-utils\"));\nconst utils_1 = require(\"@walletconnect/utils\");\nfunction generateKey(length) {\n  return tslib_1.__awaiter(this, void 0, void 0, function* () {\n    const _length = (length || 256) / 8;\n    const bytes = isoCrypto.randomBytes(_length);\n    const result = utils_1.convertBufferToArrayBuffer(encUtils.arrayToBuffer(bytes));\n    return result;\n  });\n}\nexports.generateKey = generateKey;\nfunction verifyHmac(payload, key) {\n  return tslib_1.__awaiter(this, void 0, void 0, function* () {\n    const cipherText = encUtils.hexToArray(payload.data);\n    const iv = encUtils.hexToArray(payload.iv);\n    const hmac = encUtils.hexToArray(payload.hmac);\n    const hmacHex = encUtils.arrayToHex(hmac, false);\n    const unsigned = encUtils.concatArrays(cipherText, iv);\n    const chmac = yield isoCrypto.hmacSha256Sign(key, unsigned);\n    const chmacHex = encUtils.arrayToHex(chmac, false);\n    if (encUtils.removeHexPrefix(hmacHex) === encUtils.removeHexPrefix(chmacHex)) {\n      return true;\n    }\n    return false;\n  });\n}\nexports.verifyHmac = verifyHmac;\nfunction encrypt(data, key, providedIv) {\n  return tslib_1.__awaiter(this, void 0, void 0, function* () {\n    const _key = encUtils.bufferToArray(utils_1.convertArrayBufferToBuffer(key));\n    const ivArrayBuffer = providedIv || (yield generateKey(128));\n    const iv = encUtils.bufferToArray(utils_1.convertArrayBufferToBuffer(ivArrayBuffer));\n    const ivHex = encUtils.arrayToHex(iv, false);\n    const contentString = JSON.stringify(data);\n    const content = encUtils.utf8ToArray(contentString);\n    const cipherText = yield isoCrypto.aesCbcEncrypt(iv, _key, content);\n    const cipherTextHex = encUtils.arrayToHex(cipherText, false);\n    const unsigned = encUtils.concatArrays(cipherText, iv);\n    const hmac = yield isoCrypto.hmacSha256Sign(_key, unsigned);\n    const hmacHex = encUtils.arrayToHex(hmac, false);\n    return {\n      data: cipherTextHex,\n      hmac: hmacHex,\n      iv: ivHex\n    };\n  });\n}\nexports.encrypt = encrypt;\nfunction decrypt(payload, key) {\n  return tslib_1.__awaiter(this, void 0, void 0, function* () {\n    const _key = encUtils.bufferToArray(utils_1.convertArrayBufferToBuffer(key));\n    if (!_key) {\n      throw new Error(\"Missing key: required for decryption\");\n    }\n    const verified = yield verifyHmac(payload, _key);\n    if (!verified) {\n      return null;\n    }\n    const cipherText = encUtils.hexToArray(payload.data);\n    const iv = encUtils.hexToArray(payload.iv);\n    const buffer = yield isoCrypto.aesCbcDecrypt(iv, _key, cipherText);\n    const utf8 = encUtils.arrayToUtf8(buffer);\n    let data;\n    try {\n      data = JSON.parse(utf8);\n    } catch (error) {\n      return null;\n    }\n    return data;\n  });\n}\nexports.decrypt = decrypt;","map":{"version":3,"names":["isoCrypto","tslib_1","__importStar","require","encUtils","utils_1","generateKey","length","_length","bytes","randomBytes","result","convertBufferToArrayBuffer","arrayToBuffer","exports","verifyHmac","payload","key","cipherText","hexToArray","data","iv","hmac","hmacHex","arrayToHex","unsigned","concatArrays","chmac","hmacSha256Sign","chmacHex","removeHexPrefix","encrypt","providedIv","_key","bufferToArray","convertArrayBufferToBuffer","ivArrayBuffer","ivHex","contentString","JSON","stringify","content","utf8ToArray","aesCbcEncrypt","cipherTextHex","decrypt","Error","verified","buffer","aesCbcDecrypt","utf8","arrayToUtf8","parse","error"],"sources":["../../src/index.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}