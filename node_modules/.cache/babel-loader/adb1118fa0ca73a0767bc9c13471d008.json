{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst tslib_1 = require(\"tslib\");\nconst eventemitter3_1 = tslib_1.__importDefault(require(\"eventemitter3\"));\nconst xhr2_cookies_1 = require(\"xhr2-cookies\");\nconst utils_1 = require(\"@walletconnect/utils\");\nconst XHR = utils_1.getFromWindow(\"XMLHttpRequest\") || xhr2_cookies_1.XMLHttpRequest;\nclass HTTPConnection extends eventemitter3_1.default {\n  constructor(url) {\n    super();\n    this.url = url;\n  }\n  formatError(payload, message) {\n    let code = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : -1;\n    return {\n      error: {\n        message,\n        code\n      },\n      id: payload.id,\n      jsonrpc: payload.jsonrpc\n    };\n  }\n  send(payload, internal) {\n    return new Promise(resolve => {\n      if (payload.method === \"eth_subscribe\") {\n        const error = this.formatError(payload, \"Subscriptions are not supported by this HTTP endpoint\");\n        this.emit(\"error\", error);\n        return resolve(error);\n      }\n      const xhr = new XHR();\n      let responded = false;\n      const res = (err, result) => {\n        if (!responded) {\n          xhr.abort();\n          responded = true;\n          if (internal) {\n            internal(err, result);\n          } else {\n            const {\n              id,\n              jsonrpc\n            } = payload;\n            const response = err ? {\n              id,\n              jsonrpc,\n              error: {\n                message: err.message,\n                code: err.code\n              }\n            } : {\n              id,\n              jsonrpc,\n              result\n            };\n            this.emit(\"payload\", response);\n            resolve(response);\n          }\n        }\n      };\n      xhr.open(\"POST\", this.url, true);\n      xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n      xhr.timeout = 60 * 1000;\n      xhr.onerror = res;\n      xhr.ontimeout = res;\n      xhr.onreadystatechange = () => {\n        if (xhr.readyState === 4) {\n          try {\n            const response = JSON.parse(xhr.responseText);\n            res(response.error, response.result);\n          } catch (e) {\n            res(e);\n          }\n        }\n      };\n      xhr.send(JSON.stringify(payload));\n    });\n  }\n}\nexports.default = HTTPConnection;","map":{"version":3,"names":["eventemitter3_1","tslib_1","__importDefault","require","xhr2_cookies_1","utils_1","XHR","getFromWindow","XMLHttpRequest","HTTPConnection","default","constructor","url","formatError","payload","message","code","arguments","length","undefined","error","id","jsonrpc","send","internal","Promise","resolve","method","emit","xhr","responded","res","err","result","abort","response","open","setRequestHeader","timeout","onerror","ontimeout","onreadystatechange","readyState","JSON","parse","responseText","e","stringify","exports"],"sources":["../../src/index.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}