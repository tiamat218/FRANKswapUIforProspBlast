{"ast":null,"code":"import{createAsyncThunk,createSlice}from'@reduxjs/toolkit';import{merge}from'lodash';import{ProposalState,VotingStateLoadingStatus}from'state/types';import{getAllVotes,getProposal,getProposals,getVoteVerificationStatuses}from'./helpers';const initialState={proposalLoadingStatus:VotingStateLoadingStatus.INITIAL,proposals:{},voteLoadingStatus:VotingStateLoadingStatus.INITIAL,votes:{}};// Thunks\nexport const fetchProposals=createAsyncThunk('voting/fetchProposals',async _ref=>{let{first,skip=0,state=ProposalState.ACTIVE}=_ref;const response=await getProposals(first,skip,state);return response;});export const fetchProposal=createAsyncThunk('voting/fetchProposal',async proposalId=>{const response=await getProposal(proposalId);return response;});export const fetchVotes=createAsyncThunk('voting/fetchVotes',async _ref2=>{let{proposalId,block}=_ref2;const response=await getAllVotes(proposalId,block);return{votes:response,proposalId};});export const verifyVotes=createAsyncThunk('voting/verifyVotes',async(_ref3,_ref4)=>{let{proposalId,snapshot}=_ref3;let{getState}=_ref4;const state=getState();const proposalVotes=state.voting.votes[proposalId];const response=await getVoteVerificationStatuses(proposalVotes,Number(snapshot));return{results:response,proposalId};});export const votingSlice=createSlice({name:'voting',initialState,reducers:{},extraReducers:builder=>{// Verify Votes\nbuilder.addCase(verifyVotes.fulfilled,(state,action)=>{const{proposalId,results}=action.payload;if(state.votes[proposalId]){state.votes[proposalId]=state.votes[proposalId].map(vote=>{return{...vote,_inValid:results[vote.id]===false};});}});// Fetch Proposals\nbuilder.addCase(fetchProposals.pending,state=>{state.proposalLoadingStatus=VotingStateLoadingStatus.LOADING;});builder.addCase(fetchProposals.fulfilled,(state,action)=>{const proposals=action.payload.reduce((accum,proposal)=>{return{...accum,[proposal.id]:proposal};},{});state.proposals=merge({},state.proposals,proposals);state.proposalLoadingStatus=VotingStateLoadingStatus.IDLE;});// Fetch Proposal\nbuilder.addCase(fetchProposal.pending,state=>{state.proposalLoadingStatus=VotingStateLoadingStatus.LOADING;});builder.addCase(fetchProposal.fulfilled,(state,action)=>{state.proposals[action.payload.id]=action.payload;state.proposalLoadingStatus=VotingStateLoadingStatus.IDLE;});// Fetch Votes\nbuilder.addCase(fetchVotes.pending,state=>{state.voteLoadingStatus=VotingStateLoadingStatus.LOADING;});builder.addCase(fetchVotes.fulfilled,(state,action)=>{const{votes,proposalId}=action.payload;state.votes={...state.votes,[proposalId]:votes};state.voteLoadingStatus=VotingStateLoadingStatus.IDLE;});}});export default votingSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","merge","ProposalState","VotingStateLoadingStatus","getAllVotes","getProposal","getProposals","getVoteVerificationStatuses","initialState","proposalLoadingStatus","INITIAL","proposals","voteLoadingStatus","votes","fetchProposals","_ref","first","skip","state","ACTIVE","response","fetchProposal","proposalId","fetchVotes","_ref2","block","verifyVotes","_ref3","_ref4","snapshot","getState","proposalVotes","voting","Number","results","votingSlice","name","reducers","extraReducers","builder","addCase","fulfilled","action","payload","map","vote","_inValid","id","pending","LOADING","reduce","accum","proposal","IDLE","reducer"],"sources":["C:/Users/frkul/Documents/swapUI_pancake-frontend/src/state/voting/index.tsx"],"sourcesContent":["import { createAsyncThunk, createSlice } from '@reduxjs/toolkit'\r\nimport { merge } from 'lodash'\r\nimport { Proposal, ProposalState, VotingStateLoadingStatus, VotingState, Vote, State } from 'state/types'\r\nimport { getAllVotes, getProposal, getProposals, getVoteVerificationStatuses } from './helpers'\r\n\r\nconst initialState: VotingState = {\r\n  proposalLoadingStatus: VotingStateLoadingStatus.INITIAL,\r\n  proposals: {},\r\n  voteLoadingStatus: VotingStateLoadingStatus.INITIAL,\r\n  votes: {},\r\n}\r\n\r\n// Thunks\r\nexport const fetchProposals = createAsyncThunk<Proposal[], { first?: number; skip?: number; state?: ProposalState }>(\r\n  'voting/fetchProposals',\r\n  async ({ first, skip = 0, state = ProposalState.ACTIVE }) => {\r\n    const response = await getProposals(first, skip, state)\r\n    return response\r\n  },\r\n)\r\n\r\nexport const fetchProposal = createAsyncThunk<Proposal, string>('voting/fetchProposal', async (proposalId) => {\r\n  const response = await getProposal(proposalId)\r\n  return response\r\n})\r\n\r\nexport const fetchVotes = createAsyncThunk<\r\n  { votes: Vote[]; proposalId: string },\r\n  { proposalId: string; block?: number }\r\n>('voting/fetchVotes', async ({ proposalId, block }) => {\r\n  const response = await getAllVotes(proposalId, block)\r\n  return { votes: response, proposalId }\r\n})\r\n\r\nexport const verifyVotes = createAsyncThunk<\r\n  { results: { [key: string]: boolean }; proposalId: string },\r\n  { proposalId: string; snapshot?: string },\r\n  { state: State }\r\n>('voting/verifyVotes', async ({ proposalId, snapshot }, { getState }) => {\r\n  const state = getState()\r\n  const proposalVotes = state.voting.votes[proposalId]\r\n  const response = await getVoteVerificationStatuses(proposalVotes, Number(snapshot))\r\n  return { results: response, proposalId }\r\n})\r\n\r\nexport const votingSlice = createSlice({\r\n  name: 'voting',\r\n  initialState,\r\n  reducers: {},\r\n  extraReducers: (builder) => {\r\n    // Verify Votes\r\n    builder.addCase(verifyVotes.fulfilled, (state, action) => {\r\n      const { proposalId, results } = action.payload\r\n\r\n      if (state.votes[proposalId]) {\r\n        state.votes[proposalId] = state.votes[proposalId].map((vote) => {\r\n          return {\r\n            ...vote,\r\n            _inValid: results[vote.id] === false,\r\n          }\r\n        })\r\n      }\r\n    })\r\n\r\n    // Fetch Proposals\r\n    builder.addCase(fetchProposals.pending, (state) => {\r\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING\r\n    })\r\n    builder.addCase(fetchProposals.fulfilled, (state, action) => {\r\n      const proposals = action.payload.reduce((accum, proposal) => {\r\n        return {\r\n          ...accum,\r\n          [proposal.id]: proposal,\r\n        }\r\n      }, {})\r\n\r\n      state.proposals = merge({}, state.proposals, proposals)\r\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE\r\n    })\r\n\r\n    // Fetch Proposal\r\n    builder.addCase(fetchProposal.pending, (state) => {\r\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING\r\n    })\r\n    builder.addCase(fetchProposal.fulfilled, (state, action) => {\r\n      state.proposals[action.payload.id] = action.payload\r\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE\r\n    })\r\n\r\n    // Fetch Votes\r\n    builder.addCase(fetchVotes.pending, (state) => {\r\n      state.voteLoadingStatus = VotingStateLoadingStatus.LOADING\r\n    })\r\n    builder.addCase(fetchVotes.fulfilled, (state, action) => {\r\n      const { votes, proposalId } = action.payload\r\n\r\n      state.votes = {\r\n        ...state.votes,\r\n        [proposalId]: votes,\r\n      }\r\n      state.voteLoadingStatus = VotingStateLoadingStatus.IDLE\r\n    })\r\n  },\r\n})\r\n\r\nexport default votingSlice.reducer\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}