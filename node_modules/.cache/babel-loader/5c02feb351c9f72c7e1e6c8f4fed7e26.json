{"ast":null,"code":"import BigNumber from'bignumber.js';import masterchefABI from'config/abi/masterchef.json';import erc20 from'config/abi/erc20.json';import{getAddress,getMasterChefAddress}from'utils/addressHelpers';import{BIG_TEN,BIG_ZERO}from'utils/bigNumber';import multicall from'utils/multicall';const fetchFarm=async farm=>{var _info$allocPoint;const{pid,lpAddresses,token,quoteToken}=farm;const lpAddress=getAddress(lpAddresses);const calls=[// Balance of token in the LP contract\n{address:getAddress(token.address),name:'balanceOf',params:[lpAddress]},// Balance of quote token on LP contract\n{address:getAddress(quoteToken.address),name:'balanceOf',params:[lpAddress]},// Balance of LP tokens in the master chef contract\n{address:lpAddress,name:'balanceOf',params:[getMasterChefAddress()]},// Total supply of LP tokens\n{address:lpAddress,name:'totalSupply'},// Token decimals\n{address:getAddress(token.address),name:'decimals'},// Quote token decimals\n{address:getAddress(quoteToken.address),name:'decimals'}];const[tokenBalanceLP,quoteTokenBalanceLP,lpTokenBalanceMC,lpTotalSupply,tokenDecimals,quoteTokenDecimals]=await multicall(erc20,calls);// Ratio in % of LP tokens that are staked in the MC, vs the total number in circulation\nconst lpTokenRatio=new BigNumber(lpTokenBalanceMC).div(new BigNumber(lpTotalSupply));// Raw amount of token in the LP, including those not staked\nconst tokenAmountTotal=new BigNumber(tokenBalanceLP).div(BIG_TEN.pow(tokenDecimals));const quoteTokenAmountTotal=new BigNumber(quoteTokenBalanceLP).div(BIG_TEN.pow(quoteTokenDecimals));// Amount of token in the LP that are staked in the MC (i.e amount of token * lp ratio)\nconst tokenAmountMc=tokenAmountTotal.times(lpTokenRatio);const quoteTokenAmountMc=quoteTokenAmountTotal.times(lpTokenRatio);// Total staked in LP, in quote token value\nconst lpTotalInQuoteToken=quoteTokenAmountMc.times(new BigNumber(2));// Only make masterchef calls if farm has pid\nconst[info,totalAllocPoint]=pid||pid===0?await multicall(masterchefABI,[{address:getMasterChefAddress(),name:'poolInfo',params:[pid]},{address:getMasterChefAddress(),name:'totalAllocPoint'}]):[null,null];const allocPoint=info?new BigNumber((_info$allocPoint=info.allocPoint)===null||_info$allocPoint===void 0?void 0:_info$allocPoint._hex):BIG_ZERO;const poolWeight=totalAllocPoint?allocPoint.div(new BigNumber(totalAllocPoint)):BIG_ZERO;return{tokenAmountMc:tokenAmountMc.toJSON(),quoteTokenAmountMc:quoteTokenAmountMc.toJSON(),tokenAmountTotal:tokenAmountTotal.toJSON(),quoteTokenAmountTotal:quoteTokenAmountTotal.toJSON(),lpTotalSupply:new BigNumber(lpTotalSupply).toJSON(),lpTotalInQuoteToken:lpTotalInQuoteToken.toJSON(),tokenPriceVsQuote:quoteTokenAmountTotal.div(tokenAmountTotal).toJSON(),poolWeight:poolWeight.toJSON(),multiplier:\"\".concat(allocPoint.div(100).toString(),\"X\")};};export default fetchFarm;","map":{"version":3,"names":["BigNumber","masterchefABI","erc20","getAddress","getMasterChefAddress","BIG_TEN","BIG_ZERO","multicall","fetchFarm","farm","_info$allocPoint","pid","lpAddresses","token","quoteToken","lpAddress","calls","address","name","params","tokenBalanceLP","quoteTokenBalanceLP","lpTokenBalanceMC","lpTotalSupply","tokenDecimals","quoteTokenDecimals","lpTokenRatio","div","tokenAmountTotal","pow","quoteTokenAmountTotal","tokenAmountMc","times","quoteTokenAmountMc","lpTotalInQuoteToken","info","totalAllocPoint","allocPoint","_hex","poolWeight","toJSON","tokenPriceVsQuote","multiplier","concat","toString"],"sources":["C:/Users/Devrim/Documents/FRANKswapUIforProspBlast/src/state/farms/fetchPublicFarmData.ts"],"sourcesContent":["import BigNumber from 'bignumber.js'\r\nimport masterchefABI from 'config/abi/masterchef.json'\r\nimport erc20 from 'config/abi/erc20.json'\r\nimport { getAddress, getMasterChefAddress } from 'utils/addressHelpers'\r\nimport { BIG_TEN, BIG_ZERO } from 'utils/bigNumber'\r\nimport multicall from 'utils/multicall'\r\nimport { Farm, SerializedBigNumber } from '../types'\r\n\r\ntype PublicFarmData = {\r\n  tokenAmountMc: SerializedBigNumber\r\n  quoteTokenAmountMc: SerializedBigNumber\r\n  tokenAmountTotal: SerializedBigNumber\r\n  quoteTokenAmountTotal: SerializedBigNumber\r\n  lpTotalInQuoteToken: SerializedBigNumber\r\n  lpTotalSupply: SerializedBigNumber\r\n  tokenPriceVsQuote: SerializedBigNumber\r\n  poolWeight: SerializedBigNumber\r\n  multiplier: string\r\n}\r\n\r\nconst fetchFarm = async (farm: Farm): Promise<PublicFarmData> => {\r\n  const { pid, lpAddresses, token, quoteToken } = farm\r\n  const lpAddress = getAddress(lpAddresses)\r\n  const calls = [\r\n    // Balance of token in the LP contract\r\n    {\r\n      address: getAddress(token.address),\r\n      name: 'balanceOf',\r\n      params: [lpAddress],\r\n    },\r\n    // Balance of quote token on LP contract\r\n    {\r\n      address: getAddress(quoteToken.address),\r\n      name: 'balanceOf',\r\n      params: [lpAddress],\r\n    },\r\n    // Balance of LP tokens in the master chef contract\r\n    {\r\n      address: lpAddress,\r\n      name: 'balanceOf',\r\n      params: [getMasterChefAddress()],\r\n    },\r\n    // Total supply of LP tokens\r\n    {\r\n      address: lpAddress,\r\n      name: 'totalSupply',\r\n    },\r\n    // Token decimals\r\n    {\r\n      address: getAddress(token.address),\r\n      name: 'decimals',\r\n    },\r\n    // Quote token decimals\r\n    {\r\n      address: getAddress(quoteToken.address),\r\n      name: 'decimals',\r\n    },\r\n  ]\r\n\r\n  const [tokenBalanceLP, quoteTokenBalanceLP, lpTokenBalanceMC, lpTotalSupply, tokenDecimals, quoteTokenDecimals] =\r\n    await multicall(erc20, calls)\r\n\r\n  // Ratio in % of LP tokens that are staked in the MC, vs the total number in circulation\r\n  const lpTokenRatio = new BigNumber(lpTokenBalanceMC).div(new BigNumber(lpTotalSupply))\r\n\r\n  // Raw amount of token in the LP, including those not staked\r\n  const tokenAmountTotal = new BigNumber(tokenBalanceLP).div(BIG_TEN.pow(tokenDecimals))\r\n  const quoteTokenAmountTotal = new BigNumber(quoteTokenBalanceLP).div(BIG_TEN.pow(quoteTokenDecimals))\r\n\r\n  // Amount of token in the LP that are staked in the MC (i.e amount of token * lp ratio)\r\n  const tokenAmountMc = tokenAmountTotal.times(lpTokenRatio)\r\n  const quoteTokenAmountMc = quoteTokenAmountTotal.times(lpTokenRatio)\r\n\r\n  // Total staked in LP, in quote token value\r\n  const lpTotalInQuoteToken = quoteTokenAmountMc.times(new BigNumber(2))\r\n\r\n  // Only make masterchef calls if farm has pid\r\n  const [info, totalAllocPoint] =\r\n    pid || pid === 0\r\n      ? await multicall(masterchefABI, [\r\n          {\r\n            address: getMasterChefAddress(),\r\n            name: 'poolInfo',\r\n            params: [pid],\r\n          },\r\n          {\r\n            address: getMasterChefAddress(),\r\n            name: 'totalAllocPoint',\r\n          },\r\n        ])\r\n      : [null, null]\r\n\r\n  const allocPoint = info ? new BigNumber(info.allocPoint?._hex) : BIG_ZERO\r\n  const poolWeight = totalAllocPoint ? allocPoint.div(new BigNumber(totalAllocPoint)) : BIG_ZERO\r\n\r\n  return {\r\n    tokenAmountMc: tokenAmountMc.toJSON(),\r\n    quoteTokenAmountMc: quoteTokenAmountMc.toJSON(),\r\n    tokenAmountTotal: tokenAmountTotal.toJSON(),\r\n    quoteTokenAmountTotal: quoteTokenAmountTotal.toJSON(),\r\n    lpTotalSupply: new BigNumber(lpTotalSupply).toJSON(),\r\n    lpTotalInQuoteToken: lpTotalInQuoteToken.toJSON(),\r\n    tokenPriceVsQuote: quoteTokenAmountTotal.div(tokenAmountTotal).toJSON(),\r\n    poolWeight: poolWeight.toJSON(),\r\n    multiplier: `${allocPoint.div(100).toString()}X`,\r\n  }\r\n}\r\n\r\nexport default fetchFarm\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}