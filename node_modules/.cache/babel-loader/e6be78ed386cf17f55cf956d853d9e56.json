{"ast":null,"code":"import BigNumber from 'bignumber.js';\nimport masterchefABI from 'config/abi/masterchef.json';\nimport erc20 from 'config/abi/erc20.json';\nimport { getAddress, getMasterChefAddress } from 'utils/addressHelpers';\nimport { BIG_TEN, BIG_ZERO } from 'utils/bigNumber';\nimport multicall from 'utils/multicall';\nconst fetchFarm = async farm => {\n  var _info$allocPoint;\n  const {\n    pid,\n    lpAddresses,\n    token,\n    quoteToken\n  } = farm;\n  const lpAddress = getAddress(lpAddresses);\n  const calls = [\n  // Balance of token in the LP contract\n  {\n    address: getAddress(token.address),\n    name: 'balanceOf',\n    params: [lpAddress]\n  },\n  // Balance of quote token on LP contract\n  {\n    address: getAddress(quoteToken.address),\n    name: 'balanceOf',\n    params: [lpAddress]\n  },\n  // Balance of LP tokens in the master chef contract\n  {\n    address: lpAddress,\n    name: 'balanceOf',\n    params: [getMasterChefAddress()]\n  },\n  // Total supply of LP tokens\n  {\n    address: lpAddress,\n    name: 'totalSupply'\n  },\n  // Token decimals\n  {\n    address: getAddress(token.address),\n    name: 'decimals'\n  },\n  // Quote token decimals\n  {\n    address: getAddress(quoteToken.address),\n    name: 'decimals'\n  }];\n  const [tokenBalanceLP, quoteTokenBalanceLP, lpTokenBalanceMC, lpTotalSupply, tokenDecimals, quoteTokenDecimals] = await multicall(erc20, calls);\n\n  // Ratio in % of LP tokens that are staked in the MC, vs the total number in circulation\n  const lpTokenRatio = new BigNumber(lpTokenBalanceMC).div(new BigNumber(lpTotalSupply));\n\n  // Raw amount of token in the LP, including those not staked\n  const tokenAmountTotal = new BigNumber(tokenBalanceLP).div(BIG_TEN.pow(tokenDecimals));\n  const quoteTokenAmountTotal = new BigNumber(quoteTokenBalanceLP).div(BIG_TEN.pow(quoteTokenDecimals));\n\n  // Amount of token in the LP that are staked in the MC (i.e amount of token * lp ratio)\n  const tokenAmountMc = tokenAmountTotal.times(lpTokenRatio);\n  const quoteTokenAmountMc = quoteTokenAmountTotal.times(lpTokenRatio);\n\n  // Total staked in LP, in quote token value\n  const lpTotalInQuoteToken = quoteTokenAmountMc.times(new BigNumber(2));\n\n  // Only make masterchef calls if farm has pid\n  const [info, totalAllocPoint] = pid || pid === 0 ? await multicall(masterchefABI, [{\n    address: getMasterChefAddress(),\n    name: 'poolInfo',\n    params: [pid]\n  }, {\n    address: getMasterChefAddress(),\n    name: 'totalAllocPoint'\n  }]) : [null, null];\n  const allocPoint = info ? new BigNumber((_info$allocPoint = info.allocPoint) === null || _info$allocPoint === void 0 ? void 0 : _info$allocPoint._hex) : BIG_ZERO;\n  const poolWeight = totalAllocPoint ? allocPoint.div(new BigNumber(totalAllocPoint)) : BIG_ZERO;\n  return {\n    tokenAmountMc: tokenAmountMc.toJSON(),\n    quoteTokenAmountMc: quoteTokenAmountMc.toJSON(),\n    tokenAmountTotal: tokenAmountTotal.toJSON(),\n    quoteTokenAmountTotal: quoteTokenAmountTotal.toJSON(),\n    lpTotalSupply: new BigNumber(lpTotalSupply).toJSON(),\n    lpTotalInQuoteToken: lpTotalInQuoteToken.toJSON(),\n    tokenPriceVsQuote: quoteTokenAmountTotal.div(tokenAmountTotal).toJSON(),\n    poolWeight: poolWeight.toJSON(),\n    multiplier: `${allocPoint.div(100).toString()}X`\n  };\n};\nexport default fetchFarm;","map":{"version":3,"names":["BigNumber","masterchefABI","erc20","getAddress","getMasterChefAddress","BIG_TEN","BIG_ZERO","multicall","fetchFarm","farm","_info$allocPoint","pid","lpAddresses","token","quoteToken","lpAddress","calls","address","name","params","tokenBalanceLP","quoteTokenBalanceLP","lpTokenBalanceMC","lpTotalSupply","tokenDecimals","quoteTokenDecimals","lpTokenRatio","div","tokenAmountTotal","pow","quoteTokenAmountTotal","tokenAmountMc","times","quoteTokenAmountMc","lpTotalInQuoteToken","info","totalAllocPoint","allocPoint","_hex","poolWeight","toJSON","tokenPriceVsQuote","multiplier","toString"],"sources":["C:/Users/frkul/Documents/swapUI_pancake-frontend/src/state/farms/fetchPublicFarmData.ts"],"sourcesContent":["import BigNumber from 'bignumber.js'\r\nimport masterchefABI from 'config/abi/masterchef.json'\r\nimport erc20 from 'config/abi/erc20.json'\r\nimport { getAddress, getMasterChefAddress } from 'utils/addressHelpers'\r\nimport { BIG_TEN, BIG_ZERO } from 'utils/bigNumber'\r\nimport multicall from 'utils/multicall'\r\nimport { Farm, SerializedBigNumber } from '../types'\r\n\r\ntype PublicFarmData = {\r\n  tokenAmountMc: SerializedBigNumber\r\n  quoteTokenAmountMc: SerializedBigNumber\r\n  tokenAmountTotal: SerializedBigNumber\r\n  quoteTokenAmountTotal: SerializedBigNumber\r\n  lpTotalInQuoteToken: SerializedBigNumber\r\n  lpTotalSupply: SerializedBigNumber\r\n  tokenPriceVsQuote: SerializedBigNumber\r\n  poolWeight: SerializedBigNumber\r\n  multiplier: string\r\n}\r\n\r\nconst fetchFarm = async (farm: Farm): Promise<PublicFarmData> => {\r\n  const { pid, lpAddresses, token, quoteToken } = farm\r\n  const lpAddress = getAddress(lpAddresses)\r\n  const calls = [\r\n    // Balance of token in the LP contract\r\n    {\r\n      address: getAddress(token.address),\r\n      name: 'balanceOf',\r\n      params: [lpAddress],\r\n    },\r\n    // Balance of quote token on LP contract\r\n    {\r\n      address: getAddress(quoteToken.address),\r\n      name: 'balanceOf',\r\n      params: [lpAddress],\r\n    },\r\n    // Balance of LP tokens in the master chef contract\r\n    {\r\n      address: lpAddress,\r\n      name: 'balanceOf',\r\n      params: [getMasterChefAddress()],\r\n    },\r\n    // Total supply of LP tokens\r\n    {\r\n      address: lpAddress,\r\n      name: 'totalSupply',\r\n    },\r\n    // Token decimals\r\n    {\r\n      address: getAddress(token.address),\r\n      name: 'decimals',\r\n    },\r\n    // Quote token decimals\r\n    {\r\n      address: getAddress(quoteToken.address),\r\n      name: 'decimals',\r\n    },\r\n  ]\r\n\r\n  const [tokenBalanceLP, quoteTokenBalanceLP, lpTokenBalanceMC, lpTotalSupply, tokenDecimals, quoteTokenDecimals] =\r\n    await multicall(erc20, calls)\r\n\r\n  // Ratio in % of LP tokens that are staked in the MC, vs the total number in circulation\r\n  const lpTokenRatio = new BigNumber(lpTokenBalanceMC).div(new BigNumber(lpTotalSupply))\r\n\r\n  // Raw amount of token in the LP, including those not staked\r\n  const tokenAmountTotal = new BigNumber(tokenBalanceLP).div(BIG_TEN.pow(tokenDecimals))\r\n  const quoteTokenAmountTotal = new BigNumber(quoteTokenBalanceLP).div(BIG_TEN.pow(quoteTokenDecimals))\r\n\r\n  // Amount of token in the LP that are staked in the MC (i.e amount of token * lp ratio)\r\n  const tokenAmountMc = tokenAmountTotal.times(lpTokenRatio)\r\n  const quoteTokenAmountMc = quoteTokenAmountTotal.times(lpTokenRatio)\r\n\r\n  // Total staked in LP, in quote token value\r\n  const lpTotalInQuoteToken = quoteTokenAmountMc.times(new BigNumber(2))\r\n\r\n  // Only make masterchef calls if farm has pid\r\n  const [info, totalAllocPoint] =\r\n    pid || pid === 0\r\n      ? await multicall(masterchefABI, [\r\n          {\r\n            address: getMasterChefAddress(),\r\n            name: 'poolInfo',\r\n            params: [pid],\r\n          },\r\n          {\r\n            address: getMasterChefAddress(),\r\n            name: 'totalAllocPoint',\r\n          },\r\n        ])\r\n      : [null, null]\r\n\r\n  const allocPoint = info ? new BigNumber(info.allocPoint?._hex) : BIG_ZERO\r\n  const poolWeight = totalAllocPoint ? allocPoint.div(new BigNumber(totalAllocPoint)) : BIG_ZERO\r\n\r\n  return {\r\n    tokenAmountMc: tokenAmountMc.toJSON(),\r\n    quoteTokenAmountMc: quoteTokenAmountMc.toJSON(),\r\n    tokenAmountTotal: tokenAmountTotal.toJSON(),\r\n    quoteTokenAmountTotal: quoteTokenAmountTotal.toJSON(),\r\n    lpTotalSupply: new BigNumber(lpTotalSupply).toJSON(),\r\n    lpTotalInQuoteToken: lpTotalInQuoteToken.toJSON(),\r\n    tokenPriceVsQuote: quoteTokenAmountTotal.div(tokenAmountTotal).toJSON(),\r\n    poolWeight: poolWeight.toJSON(),\r\n    multiplier: `${allocPoint.div(100).toString()}X`,\r\n  }\r\n}\r\n\r\nexport default fetchFarm\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}