{"ast":null,"code":"import{createAsyncThunk,createSlice}from'@reduxjs/toolkit';import{nftSources}from'config/constants/nfts';import{getAddress}from'utils/addressHelpers';import{getErc721Contract}from'utils/contractHelpers';import{getNftByTokenId}from'utils/collectibles';const initialState={isInitialized:false,isLoading:true,data:{}};// Thunks\nexport const fetchWalletNfts=createAsyncThunk('collectibles/fetchWalletNfts',async account=>{// For each nft source get nft data\nconst nftSourcePromises=Object.keys(nftSources).map(async nftSourceType=>{const{address:addressObj}=nftSources[nftSourceType];const address=getAddress(addressObj);const contract=getErc721Contract(address);const getTokenIdAndData=async index=>{try{const tokenIdBn=await contract.tokenOfOwnerByIndex(account,index);const tokenId=tokenIdBn.toNumber();const walletNft=await getNftByTokenId(address,tokenId);return[tokenId,walletNft.identifier];}catch(error){console.error('getTokenIdAndData',error);return null;}};const balanceOfResponse=await contract.balanceOf(account);const balanceOf=balanceOfResponse.toNumber();if(balanceOf===0){return[];}const nftDataFetchPromises=[];// For each index get the tokenId and data associated with it\nfor(let i=0;i<balanceOf;i++){nftDataFetchPromises.push(getTokenIdAndData(i));}const nftData=await Promise.all(nftDataFetchPromises);return nftData;});const nftSourceData=await Promise.all(nftSourcePromises);return nftSourceData.flat();});export const collectiblesSlice=createSlice({name:'collectibles',initialState,reducers:{},extraReducers:builder=>{builder.addCase(fetchWalletNfts.pending,state=>{state.isLoading=true;});builder.addCase(fetchWalletNfts.fulfilled,(state,action)=>{state.isLoading=false;state.isInitialized=true;state.data=action.payload.reduce((accum,association)=>{if(!association){return accum;}const[tokenId,identifier]=association;return{...accum,[identifier]:accum[identifier]?[...accum[identifier],tokenId]:[tokenId]};},{});});}});export default collectiblesSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","nftSources","getAddress","getErc721Contract","getNftByTokenId","initialState","isInitialized","isLoading","data","fetchWalletNfts","account","nftSourcePromises","Object","keys","map","nftSourceType","address","addressObj","contract","getTokenIdAndData","index","tokenIdBn","tokenOfOwnerByIndex","tokenId","toNumber","walletNft","identifier","error","console","balanceOfResponse","balanceOf","nftDataFetchPromises","i","push","nftData","Promise","all","nftSourceData","flat","collectiblesSlice","name","reducers","extraReducers","builder","addCase","pending","state","fulfilled","action","payload","reduce","accum","association","reducer"],"sources":["C:/Users/Devrim/Documents/FRANKswapUIforProspBlast/src/state/collectibles/index.ts"],"sourcesContent":["import { createAsyncThunk, createSlice } from '@reduxjs/toolkit'\r\nimport { CollectiblesState } from 'state/types'\r\nimport { nftSources } from 'config/constants/nfts'\r\nimport { NftType } from 'config/constants/types'\r\nimport { getAddress } from 'utils/addressHelpers'\r\nimport { getErc721Contract } from 'utils/contractHelpers'\r\nimport { getNftByTokenId } from 'utils/collectibles'\r\nimport { ethers } from 'ethers'\r\n\r\nconst initialState: CollectiblesState = {\r\n  isInitialized: false,\r\n  isLoading: true,\r\n  data: {},\r\n}\r\n\r\ntype NftSourceItem = [number, string]\r\n\r\n// Thunks\r\nexport const fetchWalletNfts = createAsyncThunk<NftSourceItem[], string>(\r\n  'collectibles/fetchWalletNfts',\r\n  async (account) => {\r\n    // For each nft source get nft data\r\n    const nftSourcePromises = Object.keys(nftSources).map(async (nftSourceType) => {\r\n      const { address: addressObj } = nftSources[nftSourceType as NftType]\r\n      const address = getAddress(addressObj)\r\n      const contract = getErc721Contract(address)\r\n\r\n      const getTokenIdAndData = async (index: number) => {\r\n        try {\r\n          const tokenIdBn: ethers.BigNumber = await contract.tokenOfOwnerByIndex(account, index)\r\n          const tokenId = tokenIdBn.toNumber()\r\n\r\n          const walletNft = await getNftByTokenId(address, tokenId)\r\n          return [tokenId, walletNft.identifier]\r\n        } catch (error) {\r\n          console.error('getTokenIdAndData', error)\r\n          return null\r\n        }\r\n      }\r\n\r\n      const balanceOfResponse = await contract.balanceOf(account)\r\n      const balanceOf = balanceOfResponse.toNumber()\r\n\r\n      if (balanceOf === 0) {\r\n        return []\r\n      }\r\n\r\n      const nftDataFetchPromises = []\r\n\r\n      // For each index get the tokenId and data associated with it\r\n      for (let i = 0; i < balanceOf; i++) {\r\n        nftDataFetchPromises.push(getTokenIdAndData(i))\r\n      }\r\n\r\n      const nftData = await Promise.all(nftDataFetchPromises)\r\n      return nftData\r\n    })\r\n\r\n    const nftSourceData = await Promise.all(nftSourcePromises)\r\n\r\n    return nftSourceData.flat()\r\n  },\r\n)\r\n\r\nexport const collectiblesSlice = createSlice({\r\n  name: 'collectibles',\r\n  initialState,\r\n  reducers: {},\r\n  extraReducers: (builder) => {\r\n    builder.addCase(fetchWalletNfts.pending, (state) => {\r\n      state.isLoading = true\r\n    })\r\n    builder.addCase(fetchWalletNfts.fulfilled, (state, action) => {\r\n      state.isLoading = false\r\n      state.isInitialized = true\r\n      state.data = action.payload.reduce((accum, association) => {\r\n        if (!association) {\r\n          return accum\r\n        }\r\n\r\n        const [tokenId, identifier] = association as NftSourceItem\r\n\r\n        return {\r\n          ...accum,\r\n          [identifier]: accum[identifier] ? [...accum[identifier], tokenId] : [tokenId],\r\n        }\r\n      }, {})\r\n    })\r\n  },\r\n})\r\n\r\nexport default collectiblesSlice.reducer\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}