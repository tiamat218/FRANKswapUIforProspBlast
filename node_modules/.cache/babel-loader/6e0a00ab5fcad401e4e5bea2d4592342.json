{"ast":null,"code":"import Cookies from'js-cookie';import{getProfileContract}from'utils/contractHelpers';import{getNftByTokenId}from'utils/collectibles';import{getTeam}from'state/teams/helpers';import{transformProfileResponse}from'./helpers';const profileContract=getProfileContract();const profileApi=process.env.REACT_APP_API_PROFILE;const getUsername=async address=>{try{const response=await fetch(\"\".concat(profileApi,\"/api/users/\").concat(address));if(!response.ok){return'';}const{username=''}=await response.json();return username;}catch(error){return'';}};const getProfile=async address=>{try{const hasRegistered=await profileContract.hasRegistered(address);if(!hasRegistered){return{hasRegistered,profile:null};}const profileResponse=await profileContract.getUserProfile(address);const{userId,points,teamId,tokenId,nftAddress,isActive}=transformProfileResponse(profileResponse);const team=await getTeam(teamId);const username=await getUsername(address);// If the profile is not active the tokenId returns 0, which is still a valid token id\n// so only fetch the nft data if active\nlet nft;if(isActive){var _nft;nft=await getNftByTokenId(nftAddress,tokenId);// Save the preview image in a cookie so it can be used on the exchange\nCookies.set(\"profile_\".concat(address),{username,avatar:\"https://pancakeswap.finance/images/nfts/\".concat((_nft=nft)===null||_nft===void 0?void 0:_nft.images.sm)},{domain:'pancakeswap.finance',secure:true,expires:30});}const profile={userId,points,teamId,tokenId,username,nftAddress,isActive,nft,team};return{hasRegistered,profile};}catch(error){return null;}};export default getProfile;","map":{"version":3,"names":["Cookies","getProfileContract","getNftByTokenId","getTeam","transformProfileResponse","profileContract","profileApi","process","env","REACT_APP_API_PROFILE","getUsername","address","response","fetch","concat","ok","username","json","error","getProfile","hasRegistered","profile","profileResponse","getUserProfile","userId","points","teamId","tokenId","nftAddress","isActive","team","nft","_nft","set","avatar","images","sm","domain","secure","expires"],"sources":["C:/Users/frkul/Documents/swapUI_pancake-frontend/src/state/profile/getProfile.ts"],"sourcesContent":["import Cookies from 'js-cookie'\r\nimport { getProfileContract } from 'utils/contractHelpers'\r\nimport { Nft } from 'config/constants/types'\r\nimport { getNftByTokenId } from 'utils/collectibles'\r\nimport { Profile } from 'state/types'\r\nimport { getTeam } from 'state/teams/helpers'\r\nimport { transformProfileResponse } from './helpers'\r\n\r\nconst profileContract = getProfileContract()\r\nconst profileApi = process.env.REACT_APP_API_PROFILE\r\n\r\nexport interface GetProfileResponse {\r\n  hasRegistered: boolean\r\n  profile?: Profile\r\n}\r\n\r\nconst getUsername = async (address: string): Promise<string> => {\r\n  try {\r\n    const response = await fetch(`${profileApi}/api/users/${address}`)\r\n\r\n    if (!response.ok) {\r\n      return ''\r\n    }\r\n\r\n    const { username = '' } = await response.json()\r\n\r\n    return username\r\n  } catch (error) {\r\n    return ''\r\n  }\r\n}\r\n\r\nconst getProfile = async (address: string): Promise<GetProfileResponse> => {\r\n  try {\r\n    const hasRegistered = (await profileContract.hasRegistered(address)) as boolean\r\n\r\n    if (!hasRegistered) {\r\n      return { hasRegistered, profile: null }\r\n    }\r\n\r\n    const profileResponse = await profileContract.getUserProfile(address)\r\n    const { userId, points, teamId, tokenId, nftAddress, isActive } = transformProfileResponse(profileResponse)\r\n    const team = await getTeam(teamId)\r\n    const username = await getUsername(address)\r\n\r\n    // If the profile is not active the tokenId returns 0, which is still a valid token id\r\n    // so only fetch the nft data if active\r\n    let nft: Nft\r\n    if (isActive) {\r\n      nft = await getNftByTokenId(nftAddress, tokenId)\r\n\r\n      // Save the preview image in a cookie so it can be used on the exchange\r\n      Cookies.set(\r\n        `profile_${address}`,\r\n        {\r\n          username,\r\n          avatar: `https://pancakeswap.finance/images/nfts/${nft?.images.sm}`,\r\n        },\r\n        { domain: 'pancakeswap.finance', secure: true, expires: 30 },\r\n      )\r\n    }\r\n\r\n    const profile = {\r\n      userId,\r\n      points,\r\n      teamId,\r\n      tokenId,\r\n      username,\r\n      nftAddress,\r\n      isActive,\r\n      nft,\r\n      team,\r\n    } as Profile\r\n\r\n    return { hasRegistered, profile }\r\n  } catch (error) {\r\n    return null\r\n  }\r\n}\r\n\r\nexport default getProfile\r\n"],"mappings":"AAAA,MAAO,CAAAA,OAAO,KAAM,WAAW,CAC/B,OAASC,kBAAkB,KAAQ,uBAAuB,CAE1D,OAASC,eAAe,KAAQ,oBAAoB,CAEpD,OAASC,OAAO,KAAQ,qBAAqB,CAC7C,OAASC,wBAAwB,KAAQ,WAAW,CAEpD,KAAM,CAAAC,eAAe,CAAGJ,kBAAkB,CAAC,CAAC,CAC5C,KAAM,CAAAK,UAAU,CAAGC,OAAO,CAACC,GAAG,CAACC,qBAAqB,CAOpD,KAAM,CAAAC,WAAW,CAAG,KAAO,CAAAC,OAAe,EAAsB,CAC9D,GAAI,CACF,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAC,KAAK,IAAAC,MAAA,CAAIR,UAAU,gBAAAQ,MAAA,CAAcH,OAAO,CAAE,CAAC,CAElE,GAAI,CAACC,QAAQ,CAACG,EAAE,CAAE,CAChB,MAAO,EAAE,CACX,CAEA,KAAM,CAAEC,QAAQ,CAAG,EAAG,CAAC,CAAG,KAAM,CAAAJ,QAAQ,CAACK,IAAI,CAAC,CAAC,CAE/C,MAAO,CAAAD,QAAQ,CACjB,CAAE,MAAOE,KAAK,CAAE,CACd,MAAO,EAAE,CACX,CACF,CAAC,CAED,KAAM,CAAAC,UAAU,CAAG,KAAO,CAAAR,OAAe,EAAkC,CACzE,GAAI,CACF,KAAM,CAAAS,aAAa,CAAI,KAAM,CAAAf,eAAe,CAACe,aAAa,CAACT,OAAO,CAAa,CAE/E,GAAI,CAACS,aAAa,CAAE,CAClB,MAAO,CAAEA,aAAa,CAAEC,OAAO,CAAE,IAAK,CAAC,CACzC,CAEA,KAAM,CAAAC,eAAe,CAAG,KAAM,CAAAjB,eAAe,CAACkB,cAAc,CAACZ,OAAO,CAAC,CACrE,KAAM,CAAEa,MAAM,CAAEC,MAAM,CAAEC,MAAM,CAAEC,OAAO,CAAEC,UAAU,CAAEC,QAAS,CAAC,CAAGzB,wBAAwB,CAACkB,eAAe,CAAC,CAC3G,KAAM,CAAAQ,IAAI,CAAG,KAAM,CAAA3B,OAAO,CAACuB,MAAM,CAAC,CAClC,KAAM,CAAAV,QAAQ,CAAG,KAAM,CAAAN,WAAW,CAACC,OAAO,CAAC,CAE3C;AACA;AACA,GAAI,CAAAoB,GAAQ,CACZ,GAAIF,QAAQ,CAAE,KAAAG,IAAA,CACZD,GAAG,CAAG,KAAM,CAAA7B,eAAe,CAAC0B,UAAU,CAAED,OAAO,CAAC,CAEhD;AACA3B,OAAO,CAACiC,GAAG,YAAAnB,MAAA,CACEH,OAAO,EAClB,CACEK,QAAQ,CACRkB,MAAM,4CAAApB,MAAA,EAAAkB,IAAA,CAA6CD,GAAG,UAAAC,IAAA,iBAAHA,IAAA,CAAKG,MAAM,CAACC,EAAE,CACnE,CAAC,CACD,CAAEC,MAAM,CAAE,qBAAqB,CAAEC,MAAM,CAAE,IAAI,CAAEC,OAAO,CAAE,EAAG,CAC7D,CAAC,CACH,CAEA,KAAM,CAAAlB,OAAO,CAAG,CACdG,MAAM,CACNC,MAAM,CACNC,MAAM,CACNC,OAAO,CACPX,QAAQ,CACRY,UAAU,CACVC,QAAQ,CACRE,GAAG,CACHD,IACF,CAAY,CAEZ,MAAO,CAAEV,aAAa,CAAEC,OAAQ,CAAC,CACnC,CAAE,MAAOH,KAAK,CAAE,CACd,MAAO,KAAI,CACb,CACF,CAAC,CAED,cAAe,CAAAC,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module"}